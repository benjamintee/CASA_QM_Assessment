<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-12-27">

<title>CASA0007 Assessment Submission</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="Energy_Cost_files/libs/clipboard/clipboard.min.js"></script>
<script src="Energy_Cost_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Energy_Cost_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Energy_Cost_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="Energy_Cost_files/libs/quarto-html/popper.min.js"></script>
<script src="Energy_Cost_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Energy_Cost_files/libs/quarto-html/anchor.min.js"></script>
<link href="Energy_Cost_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Energy_Cost_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Energy_Cost_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Energy_Cost_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Energy_Cost_files/libs/bootstrap/bootstrap-1fbf936f5d115924c956bdfb76a204f2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#englands-energy-crisis-is-no-longer-about-volatility---its-about-persistence-and-inequality." id="toc-englands-energy-crisis-is-no-longer-about-volatility---its-about-persistence-and-inequality." class="nav-link active" data-scroll-target="#englands-energy-crisis-is-no-longer-about-volatility---its-about-persistence-and-inequality.">England’s energy crisis is no longer about volatility - its about persistence and inequality.</a></li>
  <li><a href="#technical-appendix" id="toc-technical-appendix" class="nav-link" data-scroll-target="#technical-appendix">Technical Appendix</a>
  <ul class="collapse">
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Energy_Cost.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CASA0007 Assessment Submission</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 27, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="declaration-of-authorship" class="level2 unnumbered unlisted">
<h2 class="unnumbered unlisted anchored" data-anchor-id="declaration-of-authorship">Declaration of Authorship</h2>
<p>Date: 12 January 2026 (Tues)</p>
<p>Student Number: 25049107</p>
<p>I, Tee Chin Min Benjamin, pledge my honour that the work presented in this assessment is my own. Where information has been derived from other sources, I confirm that this has been indicated in the work. ChatGPT has been used to sharpen the language and terms used in the article and support the development of the customized graphics used in this report.</p>
<div style="page-break-after: always;"></div>
<pre><code></code></pre>
</section>
<section id="englands-energy-crisis-is-no-longer-about-volatility---its-about-persistence-and-inequality." class="level2">
<h2 class="anchored" data-anchor-id="englands-energy-crisis-is-no-longer-about-volatility---its-about-persistence-and-inequality.">England’s energy crisis is no longer about volatility - its about persistence and inequality.</h2>
<p><em>Date: 12 Jan 2026</em></p>
<p>While headline energy prices have eased since 2022, household energy bills in England remain far above pre-crisis levels. What has emerged is not a short-lived shock, but a sustained financial strain. When high energy costs persist, they begin to shape household finances and regional inequalities. Understanding who is most exposed, and why, is central to designing effective energy policy that goes beyond short-term subsidies.</p>
<section id="from-shock-to-persistence" class="level3">
<h3 class="anchored" data-anchor-id="from-shock-to-persistence">From shock to persistence</h3>
<p>The sharp rise in energy cost in 2022 was driven by global wholesale gas prices and exacerbated by geopolitical shocks<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Since then, wholesale prices have moderated, and the government’s Energy Price Guarantee (EPG) temporarily capped household exposure at the height of the crisis<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<p>Yet, this has not returned household costs to pre-2021 norms. Latest estimates show that the energy price cap remains around £600 (45%) higher than before the crisis (<u>Figure 1</u>). Moreover, the cap is projected to rise again in the coming quarters<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. While volatility has eased, prices have settled at historically high levels.</p>
<div id="31ac7379" class="cell" data-execution_count="21">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Energy_Cost_files/figure-html/cell-22-output-1.png" width="787" height="526" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This persistence places growing pressure on households. Average levels of energy debt and the number of households in arrears have risen sharply since 2021 (<u>Figure 2</u>), suggesting that many have been unable to absorb higher costs through behavioural adjustments or savings alone.</p>
<div id="3c77682e" class="cell" data-execution_count="22">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Energy_Cost_files/figure-html/cell-23-output-1.png" width="765" height="493" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>While the impact is most acute for lower-income households, higher energy costs are also squeezing the broad-middle. At least 15% of middle-income households now report struggling to heat their homes adequately<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. It is therefore unsurprising that energy costs remain at the top of public concerns. A March 2025 IPSOS UK survey<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> found that close to nine in ten respondents (88%) were worried about the price households pay for home energy — a figure unchanged since the height of the crisis (<u>Figure 3</u>).</p>
<div id="1ad596cc" class="cell" data-execution_count="23">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Energy_Cost_files/figure-html/cell-24-output-1.png" width="775" height="502" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="exposure-to-high-energy-costs-is-uneven-across-england" class="level3">
<h3 class="anchored" data-anchor-id="exposure-to-high-energy-costs-is-uneven-across-england">Exposure to high energy costs is uneven across England</h3>
<p>Although household energy prices are nationally regulated, the costs households face are far from uniform leading to unequal outcomes. Average bills depend not only on prices, but on how much energy households consume and how efficiently their homes convert energy into power.</p>
<p>As a result, some households face persistently high energy costs because they live in larger, older or less efficient homes, rely on more expensive heating systems, or have limited scope to reduce consumption. These differences reflect structural characteristics of housing rather than short-term behavioural choices alone.</p>
<p><u>Figure 4</u> illustrates this uneven exposure by mapping average household energy costs across England. Higher costs are concentrated across much of the North and Midlands, and parts of the South Coast, while lower average costs are more common in parts of the Southwest and East. There is also substantial variation within regions and cities, indicating that exposure to high energy cost is shaped by local housing conditions and energy use patterns rather than geography alone.</p>
<p>This raises a key question: <strong>if prices are broadly similar, why does its impact differ so sharply, and what does that imply for equitable energy policy?</strong></p>
<div id="2dc91633" class="cell" data-execution_count="24">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Energy_Cost_files/figure-html/cell-25-output-1.png" width="796" height="860" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-drives-differences-in-household-energy-costs" class="level3">
<h3 class="anchored" data-anchor-id="what-drives-differences-in-household-energy-costs">What drives differences in household energy costs?</h3>
<p>To explore these drivers, we estimate a multivariate model that relates average household energy costs to building age and energy efficiency, dwelling characteristics, household composition and heating infrastructure, while controlling for regional differences. We aim to identify which structural factors are most strongly associated with persistently high energy costs.</p>
<p>Results are summarised in <u>Table 1</u>. Three findings stand out.</p>
<ol type="1">
<li><strong>Housing energy inefficiency is a central driver of high costs</strong>. Areas with a higher share of energy-inefficient homes (EPC bands D-G), face significantly higher annual energy costs, even after accounting for income and other housing characteristics. Poor insulation and inefficient heating systems amplify the associated increase of high prices, meaning that households in these homes pay more regardless of their income position. Housing inefficiency does not merely coincide with low incomes; it actively magnifies exposure to high energy prices.</li>
<li><strong>Housing form and household composition matter</strong>. Older and larger dwellings, detached housing and areas with more large households all face higher energy costs, reflecting greater baseline energy needs. These factors help explain why some higher-income areas still experience high absolute cost: higher incomes often coincide with larger, more energy-intensive homes.</li>
<li><strong>Income shapes households’ capacity to absorb energy costs rather than costs alone</strong>. Higher incomes are associated with higher energy consumption and higher costs, but they also provide greater financial resilience. In contrast, areas characterised by lower incomes have far less scope to accommodate rising costs, particularly where poor housing efficiency or heating systems push cost</li>
</ol>
<table class="caption-top table">
<colgroup>
<col style="width: 61%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th>Structural factor (MSOA-level)</th>
<th>Modelled change in annual energy cost (per HH)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>+10pp share of households with 4+ people</td>
<td>≈ +£170</td>
</tr>
<tr class="even">
<td>+10% increase in median floor area of homes</td>
<td>≈ +£65-75</td>
</tr>
<tr class="odd">
<td>+10pp share of EPC D–G homes</td>
<td>≈ +£50–65</td>
</tr>
<tr class="even">
<td>+10pp share of detached homes</td>
<td>≈+£50-60</td>
</tr>
<tr class="odd">
<td>+10% increase in household income</td>
<td>≈+£50-55</td>
</tr>
<tr class="even">
<td>+10pp share of pre-1945 housing</td>
<td>≈+£15-20</td>
</tr>
</tbody>
</table>
<p><em>Note: Estimates are based on the preferred OLS specification controlling for housing characteristics, heating mix, urban–rural status and region. Effects are indicative averages and reflect associations rather than causal impact</em>.</p>
<p>These findings explain why financial pressure extends beyond the lowest-income groups. A substantial share of middle-income households report struggling with energy bills not solely because they consume unusually large amounts of energy, but because structural features expose them to persistently high costs. In equity terms, households with similar incomes can face different energy pressures depending on where and how they live.</p>
</section>
<section id="why-place-still-matters" class="level3">
<h3 class="anchored" data-anchor-id="why-place-still-matters">Why place still matters</h3>
<p>Even after accounting for income, housing characteristics and heating systems, some spatial variation in energy costs remains. This reflects localised differences in heating infrastructure, housing stock composition and settlement patterns that shape how households experience nationally regulated energy prices.</p>
<p><u>Figure 5</u> shows how the influence of income and energy efficiency vary across England. In some areas, higher incomes are closely associated with higher energy costs, reflecting consumption linked to larger or more energy-intensive homes. In others, income plays a much weaker role. In contrast, the cost penalty associated with poor housing efficiency is uneven, with inefficient homes driving higher cost in some places but less so in others.</p>
<div id="e305dd65" class="cell" data-execution_count="26">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Energy_Cost_files/figure-html/cell-27-output-1.png" width="772" height="598" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="towards-more-equitable-policy-outcomes" class="level3">
<h3 class="anchored" data-anchor-id="towards-more-equitable-policy-outcomes">Towards more equitable policy outcomes</h3>
<p>What does this mean for policy?</p>
<ol type="1">
<li><p>Blanket price suppression and universal subsidies are blunt instruments. While they reduce short-term hardship and are politically expedient, they may not address the structural reasons why some households face higher costs than others.</p></li>
<li><p>Sustained investment in housing energy efficiency offers an effective long-term responses to high energy costs. Improving insulation and upgrading heating systems directly lowers cost and reduces exposure to future price shocks, particularly where inefficient housing imposes the largest cost penalties.</p></li>
<li><p>Income matters for affordability, but place matters for exposure. Relying solely on national income thresholds risks overlooking households who face structurally high energy costs because of where and how they live. Given spatial heterogeneity, more granular, place-sensitive approaches may be needed to ensure support reaches those most exposed.</p></li>
</ol>
<p>As energy prices settle at a higher level, the challenge for policymakers is no longer how to smooth volatility, but how to prevent nationally regulated prices from becoming a permanent source of inequality, working towards an energy system that is both efficient and equitable.</p>
<div style="page-break-after: always;"></div>
<hr>
</section>
</section>
<section id="technical-appendix" class="level1">
<h1>Technical Appendix</h1>
<section id="study-objective" class="level3">
<h3 class="anchored" data-anchor-id="study-objective">1. Study Objective</h3>
<p>This study examines the structural drivers of domestic energy costs (electricity and gas) at the Middle Layer Super Output Area (MSOA) level in England. First, it identifies how housing characteristics, household composition, and heating systems are associated with variation in average annual household energy costs. Second, it assesses whether these relationships exhibit spatial dependence, indicating that some areas are systematically exposed to higher energy costs even after observable characteristics are controlled for.</p>
<p>The analysis is descriptive and explanatory rather than causal. By focusing on small-area averages, it highlights how nationally regulated energy prices translate into uneven local cost pressures through differences in housing stock, energy efficiency and household structure. The emphasis is on identifying structural sources of exposure and inequity, rather than estimating behavioural responses or causal treatment effects.</p>
</section>
<section id="data-and-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="data-and-assumptions">2. Data and Assumptions</h3>
<section id="spatial-unit-analysis-and-data-sources" class="level4">
<h4 class="anchored" data-anchor-id="spatial-unit-analysis-and-data-sources">2.1 Spatial unit analysis and data sources</h4>
<p>The analysis is conducted at MSOA level for England. MSOAs offer a balance between spatial resolution and data stability, avoiding the volatility associated with smaller geographies while preserving meaningful spatial variation.</p>
<p><u>Table 1</u> summarizes the variables considered and retained in the preferred specification</p>
<table class="caption-top table">
<colgroup>
<col style="width: 29%">
<col style="width: 25%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Source</th>
<th>Methodology &amp; assumptions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Annual electricity consumption (kWh)</td>
<td>DESNZ</td>
<td>MSOA mean domestic electricity consumption per meter (2023)</td>
</tr>
<tr class="even">
<td>Annual gas consumption (kWh)</td>
<td>DESNZ</td>
<td>MSOA mean domestic gas consumption per meter (2023)</td>
</tr>
<tr class="odd">
<td>Electricity &amp; gas prices</td>
<td>Ofgem</td>
<td>National average price cap values (incl.&nbsp;VAT), Jan–Mar 2024</td>
</tr>
<tr class="even">
<td>Annual energy cost (dependent variable)</td>
<td>Author</td>
<td>Electricity + gas consumption × unit prices + standing charges</td>
</tr>
<tr class="odd">
<td>Share of pre-1945 housing</td>
<td>VOA</td>
<td>Proxy for legacy housing inefficiency</td>
</tr>
<tr class="even">
<td>Share of EPC D–G dwellings</td>
<td>EPC Register</td>
<td>Proxy for poor energy efficiency (2019–2025)</td>
</tr>
<tr class="odd">
<td>Median floor area (log)</td>
<td>EPC Register</td>
<td>Logged to address skewness</td>
</tr>
<tr class="even">
<td>Median household income (log)</td>
<td>ONS</td>
<td>Logged MSOA income (2023)</td>
</tr>
<tr class="odd">
<td>Share of detached dwellings</td>
<td>Census 2021</td>
<td>Captures structural heat loss</td>
</tr>
<tr class="even">
<td>Share of households with 4+ occupants</td>
<td>Census 2021</td>
<td>Captures household size</td>
</tr>
<tr class="odd">
<td>Heating type shares</td>
<td>Census 2021</td>
<td>Electric-only, solid/liquid fuels, renewable networks</td>
</tr>
<tr class="even">
<td>Urban–rural indicator</td>
<td>ONS</td>
<td>Binary classification</td>
</tr>
<tr class="odd">
<td>Region</td>
<td>ONS</td>
<td>Region fixed effects</td>
</tr>
</tbody>
</table>
<p>We assume that energy prices are nationally regulated and spatially uniform, reflecting Ofgem price caps. Spatial variation in observed energy costs therefore arises from differences in consumption, housing efficiency and heating systems rather than local price-setting.</p>
</section>
<section id="exploratory-analysis-of-data-variables" class="level4">
<h4 class="anchored" data-anchor-id="exploratory-analysis-of-data-variables">2.2 Exploratory analysis of data variables</h4>
<p>Exploratory analysis (Figure A1) highlights substantial right-skewness in electricity consumption and total energy costs, driven by a subset of MSOAs with high electricity reliance and larger dwellings. As household income is also right-skewed, log-transformation is applied to stabilise variance.</p>
<p>Heating system variables are unevenly distributed across space but retained, as they represent structurally distinct energy systems with implications for electricity demand and exposure to high prices.</p>
<div id="30c01389" class="cell" data-execution_count="27">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Energy_Cost_files/figure-html/cell-28-output-1.png" width="790" height="558" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Exploratory plots of the dependent variable against key predictors (<u>Figure A2</u>) subsequently inform variable selection and specification.</p>
<div id="6f984843" class="cell" data-execution_count="28">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Energy_Cost_files/figure-html/cell-29-output-1.png" width="765" height="466" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="methodology-and-model-specification" class="level3">
<h3 class="anchored" data-anchor-id="methodology-and-model-specification">3. Methodology and Model Specification</h3>
<section id="construction-of-energy-costs" class="level4">
<h4 class="anchored" data-anchor-id="construction-of-energy-costs">3.1 Construction of energy costs</h4>
<p>Annual household energy costs are constructed by combining MSOA-level average electricity and gas consumption with national unit prices and standing charges. Electricity and gas costs are calculated separately and summed to obtain total average annual energy cost per household.</p>
</section>
<section id="regression-framework" class="level4">
<h4 class="anchored" data-anchor-id="regression-framework">3.2 Regression framework</h4>
<p>Ordinary Least Squares (OLS) regression is used as the primary modelling framework, due to its transparency and interpretability. Coefficients are interpreted as marginal associations with average annual household energy costs. All models are estimated with heteroscedasticity-robust (HC1) standard errors.</p>
<p>The preferred specification is:</p>
<p><span class="math display">\[
\begin{aligned}
\text{EnergyCost}_i
= {} &amp; \alpha
+ \beta_1 \,\text{Pre1945}_i
+ \beta_2 \,\text{EPC}_{D\text{--}G,i}
+ \beta_3 \log(\text{FloorArea}_i) \\
&amp; + \beta_4 \log(\text{Income}_i)
+ \beta_5 \,\text{Detached}_i
+ \beta_6 \,\text{HH}_{4+,i} \\
&amp; + \beta_7 \,\text{FuelMix}_i
+ \beta_8 \,\text{Urban}_i
+ \gamma_r
+ \varepsilon_i
\end{aligned}
\]</span></p>
<p>where <em>i</em> indexes MSOAs and γᵣ denotes region fixed effects.</p>
<p>Variables capture four structural dimensions:</p>
<ol type="1">
<li><p><strong>Housing age and efficiency</strong> (share pre-1945, share EPC D–G)</p></li>
<li><p><strong>Housing scale and form</strong> (log floor area, share detached)</p></li>
<li><p><strong>Household composition and income</strong> (log income, share 4+ households)</p></li>
<li><p><strong>Heating infrastructure</strong> (fuel mix indicators)</p></li>
</ol>
<p>Multicollinearity is assessed using variance inflation factors and remains within accepted thresholds.</p>
</section>
</section>
<section id="regression-findings" class="level3">
<h3 class="anchored" data-anchor-id="regression-findings">4. Regression Findings</h3>
<p>Across all specifications, <strong>structural housing characteristics and household composition emerge as the dominant drivers of energy costs</strong>.</p>
<ul>
<li><p>A higher share of EPC D–G dwellings and pre-1945 housing is consistently associated with higher annual energy costs, even after controlling for income and dwelling size.</p></li>
<li><p>Larger dwellings and detached housing are strongly associated with higher costs, reflecting greater baseline energy demand.</p></li>
<li><p>Household composition plays a particularly important role: MSOAs with a higher share of households containing four or more occupants exhibit substantially higher energy costs.</p></li>
<li><p>Fuel mix variables materially improve explanatory power (adjusted <span class="math inline">\(R^2\)</span>) rising from <span class="math inline">\(~0.58\)</span> to <span class="math inline">\(~0.70\)</span>. Electric-only heating is associated with significantly higher costs, while solid and liquid fuels are associated with lower average expenditure.</p></li>
<li><p>Urban–rural status becomes insignificant once housing and fuel characteristics are controlled for, indicating that observed urban–rural differences primarily reflect housing stock composition.</p></li>
<li><p>Region fixed effects marginally improve model fit (final adjusted <span class="math inline">\(R^2 = 0.74\)</span>) likely capturing some climatic variation and regional housing patterns.</p></li>
</ul>
<div id="4554698c" class="cell" data-execution_count="33">
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:     annual_energy_cost   R-squared:                       0.745
Model:                            OLS   Adj. R-squared:                  0.745
Method:                 Least Squares   F-statistic:                     605.9
Date:                Sat, 27 Dec 2025   Prob (F-statistic):               0.00
Time:                        17:54:24   Log-Likelihood:                -43596.
No. Observations:                6791   AIC:                         8.723e+04
Df Residuals:                    6771   BIC:                         8.737e+04
Df Model:                          19                                         
Covariance Type:                  HC1                                         
=================================================================================================
                                    coef    std err          z      P&gt;|z|      [0.025      0.975]
-------------------------------------------------------------------------------------------------
const                         -1991.0041    177.240    -11.233      0.000   -2338.387   -1643.621
share_pre1945                   160.4093     11.429     14.035      0.000     138.008     182.810
share_epc_DG                    485.2044     18.597     26.090      0.000     448.755     521.654
log_median_floor_area           664.2674     42.435     15.654      0.000     581.097     747.438
log_income                      482.3145     22.162     21.763      0.000     438.877     525.752
share_detached                  606.9683     22.990     26.402      0.000     561.909     652.027
share_hh_4plus                 1695.8907     45.159     37.554      0.000    1607.381    1784.400
urban_dummy                     -35.3910      7.313     -4.840      0.000     -49.724     -21.058
share_electric                  585.6890     47.813     12.250      0.000     491.977     679.401
share_solid_liquid            -1358.4637     44.788    -30.331      0.000   -1446.247   -1270.680
share_low_central              -453.6478    314.565     -1.442      0.149   -1070.184     162.888
share_network_renewable       -1027.8246    112.285     -9.154      0.000   -1247.899    -807.751
region_East of England           11.0321      7.778      1.418      0.156      -4.212      26.277
region_London                   -62.4682     12.890     -4.846      0.000     -87.733     -37.204
region_North East                94.4136      9.057     10.424      0.000      76.662     112.165
region_North West                68.0047      7.288      9.331      0.000      53.720      82.290
region_South East                -3.2766      7.670     -0.427      0.669     -18.309      11.756
region_South West              -122.9501      6.991    -17.586      0.000    -136.653    -109.247
region_West Midlands             57.1867      6.870      8.324      0.000      43.721      70.652
region_Yorkshire &amp; The Humber    55.4717      7.092      7.822      0.000      41.572      69.372
==============================================================================
Omnibus:                     1884.754   Durbin-Watson:                   1.270
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            10336.188
Skew:                           1.220   Prob(JB):                         0.00
Kurtosis:                       8.530   Cond. No.                         720.
==============================================================================

Notes:
[1] Standard Errors are heteroscedasticity robust (HC1)

=================================================================================
                               Base_model    Fuel_Mix   Rural/Urban   Region_FE  
---------------------------------------------------------------------------------
const                         -1708.679*** -2191.472*** -2134.568*** -1991.004***
                              (149.537)    (172.332)    (176.690)    (177.240)   
share_pre1945                 54.063***    170.840***   166.743***   160.409***  
                              (12.978)     (11.807)     (11.890)     (11.429)    
share_epc_DG                  370.801***   469.468***   473.058***   485.204***  
                              (26.637)     (18.778)     (18.817)     (18.597)    
log_median_floor_area         631.269***   770.978***   764.410***   664.267***  
                              (35.813)     (39.707)     (40.209)     (42.435)    
log_income                    412.632***   311.856***   315.012***   482.314***  
                              (14.647)     (13.942)     (13.930)     (22.162)    
share_detached                251.286***   593.177***   581.973***   606.968***  
                              (24.442)     (22.842)     (22.981)     (22.990)    
share_hh_4plus                1624.580***  1499.706***  1511.621***  1695.891*** 
                              (38.536)     (40.416)     (40.598)     (45.159)    
share_electric                             499.663***   499.889***   585.689***  
                                           (46.342)     (46.242)     (47.813)    
share_solid_liquid                         -1347.187*** -1416.278*** -1358.464***
                                           (44.446)     (44.056)     (44.788)    
share_low_central                          -1201.691*** -1147.186*** -453.648    
                                           (311.190)    (310.575)    (314.565)   
share_network_renewable                    -1107.573*** -1153.494*** -1027.825***
                                           (105.118)    (105.588)    (112.285)   
urban_dummy                                             -31.495***   -35.391***  
                                                        (7.782)      (7.313)     
region_East of England                                               11.032      
                                                                     (7.778)     
region_London                                                        -62.468***  
                                                                     (12.890)    
region_North East                                                    94.414***   
                                                                     (9.057)     
region_North West                                                    68.005***   
                                                                     (7.288)     
region_South East                                                    -3.277      
                                                                     (7.670)     
region_South West                                                    -122.950*** 
                                                                     (6.991)     
region_West Midlands                                                 57.187***   
                                                                     (6.870)     
region_Yorkshire &amp; The Humber                                        55.472***   
                                                                     (7.092)     
R-squared                     0.572        0.713        0.714        0.745       
R-squared Adj.                0.572        0.713        0.714        0.745       
N                             6791         6791         6791         6791        
R²                            0.572        0.713        0.714        0.745       
=================================================================================
Standard errors in parentheses.
* p&lt;.1, ** p&lt;.05, ***p&lt;.01</code></pre>
</div>
</div>
<p>Residual diagnostics (<u>Figure A4</u>) indicate satisfactory linearity and variance homogeneity, with mild right-skewness driven by a small number of high-electricity-cost MSOAs, driven by a small number of high-cost MSOAs characterised by larger dwellings, higher electricity reliance and limited gas connectivity.</p>
<div id="5b62ebc2" class="cell" data-execution_count="34">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Energy_Cost_files/figure-html/cell-35-output-1.png" width="667" height="581" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Variable</th>
<th data-quarto-table-cell-role="th">VIF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>region_North East</td>
<td>1.686154</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>share_epc_DG</td>
<td>1.902158</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>share_hh_4plus</td>
<td>1.927551</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>region_Yorkshire &amp; The Humber</td>
<td>2.067431</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>region_South West</td>
<td>2.071966</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>region_West Midlands</td>
<td>2.102305</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>share_pre1945</td>
<td>2.106134</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>urban_dummy</td>
<td>2.147526</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>share_electric</td>
<td>2.224277</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>region_East of England</td>
<td>2.245763</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>share_network_renewable</td>
<td>2.277739</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>region_North West</td>
<td>2.469844</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>region_South East</td>
<td>2.849354</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>share_solid_liquid</td>
<td>3.225414</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>share_detached</td>
<td>3.631050</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>log_median_floor_area</td>
<td>3.815178</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>log_income</td>
<td>4.066691</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>share_low_central</td>
<td>4.577141</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>region_London</td>
<td>5.265254</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="unpacking-spatial-dependence-via-spatial-error-model-sem-and-geographically-weighted-regression-gwr" class="level3">
<h3 class="anchored" data-anchor-id="unpacking-spatial-dependence-via-spatial-error-model-sem-and-geographically-weighted-regression-gwr">5. Unpacking spatial dependence via Spatial Error Model (SEM) and Geographically Weighted Regression (GWR)</h3>
<p>Global Moran’s I tests on OLS residuals reveal significant positive spatial autocorrelation (<span class="math inline">\(I = 0.43\)</span>), indicating that neighbouring MSOAs share some unobserved characteristics influencing energy costs.</p>
<div id="a4342a56" class="cell" data-execution_count="36">
<div class="cell-output cell-output-stdout">
<pre><code>Moran's I value  =  0.43 with p = 0.001</code></pre>
</div>
</div>
<p>To account for this, a Spatial Error Model (SEM) was estimated using maximum likelihood. The SEM identifies strong spatial correlation in the error term <span class="math inline">\((λ ≈ 0.73)\)</span>, consistent with omitted spatially structured factors such as housing typologies, retrofit histories or local infrastructure.</p>
<div id="d490d32e" class="cell" data-execution_count="37">
<div class="cell-output cell-output-stdout">
<pre><code>REGRESSION RESULTS
------------------

SUMMARY OF OUTPUT: ML SPATIAL ERROR (METHOD = full)
---------------------------------------------------
Data set            :     unknown
Weights matrix      :     unknown
Dependent Variable  :annual_energy_cost                Number of Observations:        6791
Mean dependent var  :   2130.8608                Number of Variables   :          11
S.D. dependent var  :    294.3179                Degrees of Freedom    :        6780
Pseudo R-squared    :      0.6920
Log likelihood      : -42323.4933
Sigma-square ML     :  13329.1753                Akaike info criterion :   84668.987
S.E of regression   :    115.4520                Schwarz criterion     :   84744.043

------------------------------------------------------------------------------------
            Variable     Coefficient       Std.Error     z-Statistic     Probability
------------------------------------------------------------------------------------
            CONSTANT     -1796.30377        77.33022       -23.22900         0.00000
       share_pre1945       194.45965        10.24099        18.98837         0.00000
        share_epc_DG       408.82274        16.59709        24.63219         0.00000
log_median_floor_area       732.10715        19.44254        37.65490         0.00000
          log_income       175.13365        17.99068         9.73469         0.00000
      share_detached       704.82340        17.02771        41.39273         0.00000
      share_hh_4plus      1031.84763        42.01742        24.55761         0.00000
      share_electric       550.09246        36.92569        14.89728         0.00000
  share_solid_liquid     -1108.54704        33.07389       -33.51729         0.00000
   share_low_central      -747.51343       256.90902        -2.90964         0.00362
share_network_renewable     -1183.19779        75.24002       -15.72564         0.00000
              lambda         0.73423         0.01009        72.76398         0.00000
------------------------------------------------------------------------------------
Warning: Variable(s) ['const'] removed for being constant.
================================ END OF REPORT =====================================</code></pre>
</div>
</div>
<p>Importantly, coefficient magnitudes and signs remain broadly consistent with OLS results. This suggests that the main findings are robust, while acknowledging that exposure to high energy costs is partially shaped by spatially clustered, unobserved characteristics rather than indicating misspecification of the core structural relationships.</p>
<p>Geographically Weighted Regression (GWR) was further used to explore spatial heterogeneity in coefficients, focusing on income and EPC D–G share. An adaptive bandwidth is selected via AICc.</p>
<div id="9eda9ff3" class="cell" data-execution_count="40">
<div class="cell-output cell-output-stdout">
<pre><code>===========================================================================
Model type                                                         Gaussian
Number of observations:                                                6791
Number of covariates:                                                     7

Global Regression Results
---------------------------------------------------------------------------
Residual sum of squares:                                       251463249.319
Log-likelihood:                                                  -45354.817
AIC:                                                              90723.635
AICc:                                                             90725.656
BIC:                                                           251403391.689
R2:                                                                   0.572
Adj. R2:                                                              0.572

Variable                              Est.         SE  t(Est/SE)    p-value
------------------------------- ---------- ---------- ---------- ----------
X0                                2130.861      2.336    912.069      0.000
X1                                  12.273      3.159      3.885      0.000
X2                                  47.948      3.009     15.933      0.000
X3                                  95.718      3.720     25.732      0.000
X4                                  79.856      2.638     30.270      0.000
X5                                  45.824      3.832     11.958      0.000
X6                                 106.246      2.504     42.432      0.000

Geographically Weighted Regression (GWR) Results
---------------------------------------------------------------------------
Spatial kernel:                                           Adaptive bisquare
Bandwidth used:                                                     150.000

Diagnostic information
---------------------------------------------------------------------------
Residual sum of squares:                                       66737182.197
Effective number of parameters (trace(S)):                          781.589
Degree of freedom (n - trace(S)):                                  6009.411
Sigma estimate:                                                     105.382
Log-likelihood:                                                  -40850.569
AIC:                                                              83266.316
AICc:                                                             83470.474
BIC:                                                              88606.198
R2:                                                                   0.887
Adjusted R2:                                                          0.872
Adj. alpha (95%):                                                     0.000
Adj. critical t value (95%):                                          3.512

Summary Statistics For GWR Parameter Estimates
---------------------------------------------------------------------------
Variable                   Mean        STD        Min     Median        Max
-------------------- ---------- ---------- ---------- ---------- ----------
X0                     2207.978    220.538    750.347   2174.820   4028.941
X1                       25.620     29.360   -112.746     27.736    145.976
X2                       41.445     49.019    -86.375     37.515    247.654
X3                       55.842     55.332    -89.084     51.246    300.521
X4                       89.186     51.328   -132.501     83.049    368.157
X5                      148.396    192.089   -973.502    106.330   1634.113
X6                       69.078     45.897   -123.661     70.263    229.571
===========================================================================

None</code></pre>
</div>
</div>
<p>Results show substantial spatial variation:</p>
<ul>
<li><p>In some areas, income is strongly associated with higher energy costs, reflecting consumption-driven demand</p></li>
<li><p>In others, the EPC D–G coefficient dominates, indicating that poor housing efficiency imposes high costs regardless of income.</p></li>
</ul>
<p>GWR substantially improves model fit (<span class="math inline">\(R^2 &gt; 0.88\)</span>), but is interpreted as exploratory, highlighting where mechanisms differ rather than replacing global estimates. The high <span class="math inline">\(R^2\)</span> reflects local overfitting inherent to GWR and should not be interpreted as superior explanatory power relative to the global model.”</p>
</section>
<section id="reflections-and-limitations" class="level3">
<h3 class="anchored" data-anchor-id="reflections-and-limitations">6. Reflections and Limitations</h3>
<p>This analysis is subject to several limitations. As an ecological study, it cannot capture within-area household heterogeneity or behavioural responses such as under-heating. Prices are assumed spatially uniform, and retrofit history is not directly observed.</p>
<p>Residual spatial clustering reflects genuine structural heterogeneity rather than model failure. From an equity perspective, the results underline that exposure to high energy costs is shaped by place-specific housing conditions, not income alone. This reinforces the need for policy approaches that integrate housing efficiency and local context alongside income-based support.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Russia-Ukraine War (<a href="https://commonslibrary.parliament.uk/research-briefings/cbp-9714/" class="uri">https://commonslibrary.parliament.uk/research-briefings/cbp-9714/</a>)<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>In Sep 22, then-Prime Minister Elizabeth Truss announced the implementation of an Energy Price Guarantee (EPG) which meant that a typical UK household would pay up to £2,500 a year on their energy bill for the next two years. <a href="https://www.gov.uk/government/news/government-announces-energy-price-guarantee-for-families-and-businesses-while-urgently-taking-action-to-reform-broken-energy-market" class="uri">https://www.gov.uk/government/news/government-announces-energy-price-guarantee-for-families-and-businesses-while-urgently-taking-action-to-reform-broken-energy-market</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Cornwall insights forecasts that the price cap for energy bills is expected to rise by 3.2% in 2Q26, to take into account increases in network costs for electricity. <a href="https://www.cornwall-insight.com/press-and-media/press-release/bills-remain-stable-but-new-forecast-signals-increases-in-april/" class="uri">https://www.cornwall-insight.com/press-and-media/press-release/bills-remain-stable-but-new-forecast-signals-increases-in-april/</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Analysis by Joseph Rowntree Foundation using data from Family Resources Survey 2023/2024, Department for Work and Pensions. <a href="https://www.jrf.org.uk/cost-of-living/energy-affordability-how-to-reduce-bills-for-majority-of-households" class="uri">https://www.jrf.org.uk/cost-of-living/energy-affordability-how-to-reduce-bills-for-majority-of-households</a><a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p><a href="https://www.ipsos.com/en-uk/almost-nine-ten-britons-are-concerned-about-energy-prices" class="uri">https://www.ipsos.com/en-uk/almost-nine-ten-britons-are-concerned-about-energy-prices</a><a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>